USE email_db;

DROP TABLE IF EXISTS ATTACHMENT;
DROP TABLE IF EXISTS BCCEMAIL;
DROP TABLE IF EXISTS CCEMAIL;
DROP TABLE IF EXISTS TOEMAIL;
DROP TABLE IF EXISTS EMAILMESSAGE;
DROP TABLE IF EXISTS EMAIL;
DROP TABLE IF EXISTS FOLDER;

CREATE TABLE EMAIL (
    ID int(11) NOT NULL auto_increment,
    USEREMAIL varchar(50) NOT NULL,
    FROMEMAIL varchar(50) NOT NULL,
    SUBJECT varchar(50) NOT NULL,
    SENDDATE datetime,
    RECEIVEDATE datetime,
    FOLDERNAME varchar(40) NOT NULL,
    FLAGS varchar(40),
    PRIMARY KEY (ID)
);


CREATE TABLE EMAILMESSAGE (
    ID int(11) NOT NULL auto_increment,
    CONTENT text NOT NULL,
    ENCODING varchar(10),
    MIMETYPE varchar(60),
    EMAILID int(11) NOT NULL,
    PRIMARY KEY (ID)
);


CREATE TABLE TOEMAIL (
    ID int(11) NOT NULL auto_increment,
    EMAILADDRESS varchar(50) NOT NULL,
    EMAILID int(11) NOT NULL,
    PRIMARY KEY (ID)
);


CREATE TABLE CCEMAIL (
    ID int(11) NOT NULL auto_increment,
    EMAILADDRESS varchar(50) NOT NULL,
    EMAILID int(11) NOT NULL,
    PRIMARY KEY (ID)
);


CREATE TABLE BCCEMAIL (
    ID int(11) NOT NULL auto_increment,
    EMAILADDRESS varchar(50) NOT NULL,
    EMAILID int(11) NOT NULL,
    PRIMARY KEY (ID)
);


CREATE TABLE ATTACHMENT (
    ID int(11) NOT NULL auto_increment,
    FILENAME varchar(255),
    FILEDATA mediumblob NOT NULL,
    FILESIZE int(36) NOT NULL,
    EMAILID int(11) NOT NULL,
    PRIMARY KEY (ID)
);


CREATE TABLE FOLDER (
    FOLDERNAME varchar(40) NOT NULL,
    PRIMARY KEY (FOLDERNAME)
);


ALTER TABLE EMAILMESSAGE ADD FOREIGN KEY (EMAILID) REFERENCES EMAIL(ID) ON DELETE CASCADE;
ALTER TABLE TOEMAIL ADD FOREIGN KEY (EMAILID) REFERENCES EMAIL(ID) ON DELETE CASCADE;
ALTER TABLE CCEMAIL ADD FOREIGN KEY (EMAILID) REFERENCES EMAIL(ID) ON DELETE CASCADE;
ALTER TABLE BCCEMAIL ADD FOREIGN KEY (EMAILID) REFERENCES EMAIL(ID) ON DELETE CASCADE;
ALTER TABLE ATTACHMENT ADD FOREIGN KEY (EMAILID) REFERENCES EMAIL(ID) ON DELETE CASCADE;
ALTER TABLE EMAIL ADD FOREIGN KEY (FOLDERNAME) REFERENCES FOLDER(FOLDERNAME) ON DELETE CASCADE;


INSERT INTO FOLDER (FOLDERNAME) VALUES("Inbox");
INSERT INTO FOLDER (FOLDERNAME) VALUES("Sent");

INSERT INTO EMAIL (USEREMAIL, FROMEMAIL, SUBJECT, SENDDATE, RECEIVEDATE, FOLDERNAME, FLAGS) VALUES("hugo.sender.not.a.bot@gmail.com", "creepy_guy@stalker.com", "I like to stalk people", NOW(), NOW(), "Inbox", null);
INSERT INTO TOEMAIL (EMAILADDRESS, EMAILID) VALUES ("hugo.sender.not.a.bot@gmail.com", 1);
INSERT INTO EMAILMESSAGE (CONTENT, EMAILID) VALUES ("I love you.", 1);